<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MixMate â€” ãƒ¯ãƒ³ã‚¿ãƒƒãƒ—è‡ªå‹•ãƒŸã‚­ã‚·ãƒ³ã‚°</title>
  <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
  <link rel="icon" href="{{ url_for('static', filename='icon-192.png') }}">
  <link rel="apple-touch-icon" href="{{ url_for('static', filename='icon-512.png') }}">
  <meta name="theme-color" content="#0ea5a8" />
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">

  <!-- ãƒ†ã‚¹ãƒˆç”¨çµ±ä¸€ã‚°ãƒ¬ãƒ¼ã‚¢ã‚¦ãƒˆCSS -->
  <style>
  .disabled-section,
  .disabled-section.grid2,
  .disabled-section.card {
    opacity: 0.7 !important;
    filter: grayscale(30%) !important;
    pointer-events: none !important;
    background-color: transparent !important;
  }

  .disabled-section *,
  .disabled-section.grid2 *,
  .disabled-section.card * {
    opacity: inherit !important;
    filter: inherit !important;
  }

  /* ã‚¹ãƒ”ãƒŠãƒ¼ã¯ç„¡åŠ¹åŒ–ã®å¯¾è±¡å¤–ã«ã™ã‚‹ */
  .disabled-section .simple-spinner {
    opacity: 1 !important;
    filter: none !important;
    pointer-events: auto !important;
  }
  </style></head>
<body>

<header class="header">
    <div class="logo">ğŸ§ MixMate</div>
    <label class="pro-toggle disabled"><input id="pro_glance" type="checkbox" disabled> ãƒ—ãƒ­ãƒ¢ãƒ¼ãƒ‰</label>
  </header>

  <main class="container">
    <section class="card">
      <h2>â‘  ãƒ•ã‚¡ã‚¤ãƒ«ã‚’é¸æŠ</h2>
      <input id="file" type="file" accept="audio/wav,audio/mp3,audio/m4a,audio/aac,audio/flac,audio/ogg,.wav,.mp3,.m4a,.aac,.flac,.ogg" />
    </section>

    <section class="card grid2 disabled-section" id="preset_section">
      <div>
        <h2>â‘¡ ãƒ—ãƒªã‚»ãƒƒãƒˆ
          <span id="preset_spinner" class="simple-spinner" style="display: none;"></span>
          <span id="preset_text_indicator" style="display: none; color: #ff4444; margin-left: 8px; font-size: 0.9em;">å‡¦ç†ä¸­...</span>
        </h2>
        <div class="field">
          <span>åŸºæœ¬è¨­å®š</span>
          <div id="gender_toggle" class="seg">
            <button type="button" data-val="male" aria-selected="true">ç”·æ€§</button>
            <button type="button" data-val="female">å¥³æ€§</button>
            <button type="button" data-val="smartphone" 
                    title="ã‚¹ãƒãƒ›åéŒ²éŸ³å£°ç”¨ã®å‘¨æ³¢æ•°ç‰¹æ€§è£œæ­£">SP</button>
          </div>
        </div>
        <div class="field">
          <span>ã‚¹ã‚¿ã‚¤ãƒ«</span>
          <div id="style_toggle" class="seg">
            <button type="button" data-val="rock">ROCK</button>
            <button type="button" data-val="pop" aria-selected="true">POP</button>
            <button type="button" data-val="ballad">Ballad</button>
            <button type="button" data-val="narration">Narration</button>
            <!-- Wideä¸€æœ¬ã€‚data-valã¯ chorus_wide ã®ã¾ã¾ã€ãƒ©ãƒ™ãƒ«ã ã‘â€œChorusâ€ã«ã—ã¦OK -->
            <button type="button" data-val="chorus_wide"
                    title="ã‚¹ãƒ†ãƒ¬ã‚ªå°‚ç”¨ï¼ˆãƒ¢ãƒã§è–„ããªã‚Šã¾ã™ï¼‰">Chorus</button>
          </div>
        </div>
        <div class="field">
          <span>ãƒã‚¤ã‚ºã‚²ãƒ¼ãƒˆ</span>
          <div id="ng_toggle" class="seg">
            <button type="button" data-val="weak" aria-selected="true">å¼±ã‚</button>
            <button type="button" data-val="strong">å¼·ã‚</button>
          </div>
        </div>

        <!-- åŸºæœ¬è¨­å®šé©ç”¨ãƒœã‚¿ãƒ³ -->
        <div class="field" style="margin-top: 16px;">
          <div style="display: flex; justify-content: center;">
            <button id="preset_apply" class="btn btn-sm" type="button"
                    style="background: #10b981; color: white; padding: 8px 24px; font-weight: 600;">
              åŸºæœ¬è¨­å®šã‚’é©ç”¨
            </button>
          </div>
          <small style="text-align: center; color: #888; margin-top: 4px; display: block;">
            ä¸Šè¨˜3ã¤ã®è¨­å®šã‚’ã¾ã¨ã‚ã¦é©ç”¨ã—ã¾ã™
          </small>
        </div>

<!-- BPM ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆã“ã“ã¯ã“ã®å½¢ã§é–‰ã˜ã‚‹ï¼‰ -->
<div class="field">
  <span>BPMï¼ˆãƒ‡ã‚£ãƒ¬ã‚¤åŒæœŸï¼‰</span>
  <div class="bpm-row">
    <input id="bpm_input" type="number" inputmode="numeric" min="60" max="200" step="1"
           placeholder="æœªè¨­å®šæ™‚ã¯è‡ªå‹•" />
    <button id="bpm_apply" class="btn btn-sm" type="button" aria-label="BPMã‚’é©ç”¨">é©ç”¨</button>
  </div>
  <small>ç©ºæ¬„ã®å ´åˆã¯æ¥½æ›²ã‚¹ã‚¿ã‚¤ãƒ«ã«å¿œã˜ãŸæ¨™æº–å€¤ã‚’ä½¿ç”¨</small>

</div>

</div>

</div>
<div class="disabled-section" id="preview_section">
  <h2>â‘¢ ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ & ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</h2>
  <div style="display:flex;gap:8px;flex-wrap:wrap">
    <button id="preview"  class="btn" style="background:#38bdf8">ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼å†ç”Ÿ</button>
    <button id="download" class="btn">é«˜å“è³ªã§ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
  </div>
  <div id="status" class="status"></div>

  <!-- ãƒ–ãƒ©ã‚¦ã‚¶å†…ã§è©¦è´ã™ã‚‹ãŸã‚ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ -->
  <audio id="preview_audio" controls playsinline style="margin-top:10px; width:100%"></audio>

  <!-- â–¼ ç©ºé–“ã®å€‹åˆ¥èª¿æ•´ï¼ˆè¦‹ãŸç›®ã¨UIæŒ™å‹•ã®ã¿ã€‚ã‚µãƒ¼ãƒé€ä¿¡ã¯ã¾ã çµç·šã—ãªã„ï¼‰ -->
<div id="space_split_section" class="disabled-section" style="margin-top:12px; padding:10px; border:1px solid #2a2a2a; border-radius:10px;">
  <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
    <strong>å€‹åˆ¥èª¿æ•´</strong>
  </div>

  <div class="field" style="margin:6px 0;">
    <div style="display:grid; grid-template-columns:repeat(2, minmax(0, 1fr)); gap:8px; align-items:start;">

      <!-- Delayï¼ˆå·¦ä¸Šï¼‰ -->
      <div>
        <span>Delay é‡</span>
        <div id="delay_space_toggle" class="seg">
          <button type="button" data-val="-4">æ§ãˆã‚</button>
          <button type="button" data-val="0" aria-selected="true">æ¨™æº–</button>
          <button type="button" data-val="+4">å¼·ã‚</button>
        </div>
      </div>

      <!-- Compï¼ˆå³ä¸Šï¼‰ -->
      <div>
        <span>Comp é‡</span>
        <div id="comp2_amount_toggle" class="seg">
          <button type="button" data-val="-3">æ§ãˆã‚</button>
          <button type="button" data-val="-7" aria-selected="true">æ¨™æº–</button>
          <button type="button" data-val="-10">å¼·ã‚</button>
        </div>
      </div>

      <!-- Reverbï¼ˆå·¦ä¸‹ï¼‰ â† ã“ã“ã‚’å·¦ä¸‹ã«ç§»å‹• -->
      <div>
        <span>Reverb é‡</span>
        <div id="reverb_space_toggle" class="seg">
          <button type="button" data-val="-4">æ§ãˆã‚</button>
          <button type="button" data-val="0" aria-selected="true">æ¨™æº–</button>
          <button type="button" data-val="+4">å¼·ã‚</button>
        </div>
      </div>

      <!-- Saturationï¼ˆå³ä¸‹ï¼‰ â† ã“ã“ã‚’å³ä¸‹ã«ç§»å‹• -->
      <div>
        <span>Saturation é‡</span>
        <div id="sat_amount_toggle" class="seg">
          <button type="button" data-val="0.2">æ§ãˆã‚</button>
          <button type="button" data-val="0.4" aria-selected="true">æ¨™æº–</button>
          <button type="button" data-val="0.7">å¼·ã‚</button>
        </div>
      </div>

    </div>
  </div>

  <!-- å€‹åˆ¥èª¿æ•´é©ç”¨ãƒœã‚¿ãƒ³ -->
  <div class="field" style="margin-top: 16px;">
    <div style="display: flex; justify-content: center;">
      <button id="space_apply" class="btn btn-sm" type="button"
              style="background: #3b82f6; color: white; padding: 8px 24px; font-weight: 600;">
        å€‹åˆ¥èª¿æ•´ã‚’é©ç”¨
      </button>
    </div>
    <small style="text-align: center; color: #888; margin-top: 4px; display: block;">
      ä¸Šè¨˜4ã¤ã®è¨­å®šã‚’ã¾ã¨ã‚ã¦é©ç”¨ã—ã¾ã™
    </small>
  </div>
</div>

    <div class="field" style="margin:6px 0;">

  <!-- â–² ç©ºé–“ã®å€‹åˆ¥èª¿æ•´ -->
</div>
</section> <!-- â† ç›´å‰ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’é–‰ã˜ã‚‹ -->

<section id="comp_glance" class="card" hidden>
  <h2>ãƒ—ãƒ­ãƒ¢ãƒ¼ãƒ‰ï¼šå‡¦ç†ã®å¯è¦–åŒ–ï¼ˆèª­ã¿å–ã‚Šå°‚ç”¨ï¼‰</h2>
  <div class="stage">
    <div class="head">
      <strong>Stage 1</strong><span class="sub">1176 / R-Voxï¼ˆæ•´éŸ³ï¼‰</span>
      <span id="gr1_db" class="pill">GR: -- dB</span>
    </div>
    <div class="meter"><div id="gr1_bar"></div></div>
  </div>
  <div class="stage">
    <div class="head">
      <strong>Stage 2</strong><span class="sub">LA-2Aï¼ˆä»•ä¸Šã’ï¼‰</span>
      <span id="gr2_db" class="pill">GR: -- dB</span>
    </div>
    <div class="meter"><div id="gr2_bar"></div></div>
  </div>
  <div class="summary">
    <span id="lufs">LUFS: --</span>
    <span id="tp">TP: -- dBTP</span>
  </div>
</section>

<section id="fx_list" class="card" hidden>
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px;">
    <h2 style="margin: 0;">ãƒ—ãƒ­ãƒ¢ãƒ¼ãƒ‰</h2>

    <!-- ã‚¨ãƒ•ã‚§ã‚¯ãƒˆä¸€æ‹¬ã‚ªãƒ³ã‚ªãƒ•ãƒœã‚¿ãƒ³ï¼ˆå³å´ã«é…ç½®ï¼‰ -->
    <div class="fx-bulk-controls-header">
      <button id="bulk_all_on" class="bulk-fx-btn-small" type="button">
        å…¨ON
      </button>
      <button id="bulk_all_off" class="bulk-fx-btn-small" type="button">
        å…¨OFF
      </button>
    </div>
  </div>

  <div id="fx_items"></div>
</section>
  </main>

<!-- ãƒ—ãƒªã‚»ãƒƒãƒˆå¤‰æ›´ç”¨ã®ä¸­å¤®ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°è¡¨ç¤º -->
<div id="preset_loading_overlay" class="preset-loading-overlay" style="display: none;">
  <div class="preset-loading-container">
    <div class="preset-loading-spinner"></div>
    <div class="preset-loading-text">ãƒ—ãƒªã‚»ãƒƒãƒˆå¤‰æ›´ä¸­...</div>
  </div>
</div>

<!-- ã‚¨ãƒ³ãƒãƒ³ã‚¹ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ -->
  <div id="progress_overlay" class="progress-overlay">
    <div class="progress-container">
      <!-- ã‚¢ã‚¤ã‚³ãƒ³ã¨ã‚¿ã‚¤ãƒˆãƒ« -->
      <div class="progress-header">
        <div class="progress-icon">
          <div class="audio-wave-icon">
            <span></span><span></span><span></span>
          </div>
        </div>
        <div id="progress_title" class="progress-title">ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‡¦ç†ä¸­...</div>
      </div>

      <!-- æ®µéšãƒ‰ãƒƒãƒˆè¡¨ç¤ºï¼ˆæ”¹è‰¯ç‰ˆï¼‰ -->
      <div class="progress-stages">
        <div class="stage-connection"></div>
        <div class="stage-dot" data-stage="0"><span>èª­è¾¼</span></div>
        <div class="stage-dot" data-stage="1"><span>è§£æ</span></div>
        <div class="stage-dot" data-stage="2"><span>å‡¦ç†</span></div>
        <div class="stage-dot" data-stage="3"><span>ç”Ÿæˆ</span></div>
        <div class="stage-dot" data-stage="4"><span>å®Œäº†</span></div>
      </div>

      <!-- ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚°ãƒ¬ã‚¹ãƒãƒ¼ï¼ˆæ”¹è‰¯ç‰ˆï¼‰ -->
      <div class="progress-bar-wrapper">
        <div class="progress-bar-bg">
          <div id="progress_bar" class="progress-bar">
            <div class="progress-bar-shine"></div>
          </div>
          <div class="progress-percentage" id="progress_percentage">0%</div>
        </div>
      </div>

      <!-- æ³¢å½¢ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆæ”¹è‰¯ç‰ˆï¼‰ -->
      <div class="waveform-container">
        <div class="waveform-label">ğŸµ éŸ³å£°å‡¦ç†ä¸­</div>
        <div class="waveform-bars">
          <div class="waveform-bar" style="animation-delay: 0ms;"></div>
          <div class="waveform-bar" style="animation-delay: 100ms;"></div>
          <div class="waveform-bar" style="animation-delay: 200ms;"></div>
          <div class="waveform-bar" style="animation-delay: 300ms;"></div>
          <div class="waveform-bar" style="animation-delay: 400ms;"></div>
          <div class="waveform-bar" style="animation-delay: 500ms;"></div>
          <div class="waveform-bar" style="animation-delay: 600ms;"></div>
          <div class="waveform-bar" style="animation-delay: 700ms;"></div>
          <div class="waveform-bar" style="animation-delay: 800ms;"></div>
          <div class="waveform-bar" style="animation-delay: 900ms;"></div>
        </div>
      </div>

      <!-- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹æƒ…å ± -->
      <div class="progress-status">
        <div class="progress-time-info">
          <div id="progress_text" class="progress-text">ãŠå¾…ã¡ãã ã•ã„...</div>
          <div class="time-display">
            <span class="time-label">çµŒéæ™‚é–“:</span>
            <span id="elapsed_time" class="time-value">0:00</span>
          </div>
        </div>
        <div class="progress-stats">
          <div class="stat-item">
            <span class="stat-label">æ®µéš</span>
            <span id="current_stage" class="stat-value">1/5</span>
          </div>
          <div class="stat-item">
            <span class="stat-label">å“è³ª</span>
            <span class="stat-value">é«˜å“è³ª</span>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="{{ url_for('static', filename='script.js') }}"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('{{ url_for('static', filename='sw.js') }}');
    }
  </script>
</body>
</html>
